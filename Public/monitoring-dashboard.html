<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Roadmap Generator - Monitoring Dashboard</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #0f172a;
      color: #e2e8f0;
      padding: 20px;
    }
    .container { max-width: 1400px; margin: 0 auto; }
    h1 {
      font-size: 32px;
      margin-bottom: 30px;
      color: #60a5fa;
      text-align: center;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    .card {
      background: #1e293b;
      border-radius: 12px;
      padding: 24px;
      border: 1px solid #334155;
    }
    .card h2 {
      font-size: 18px;
      color: #94a3b8;
      margin-bottom: 16px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .metric {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid #334155;
    }
    .metric:last-child { border-bottom: none; }
    .metric-label {
      color: #94a3b8;
      font-size: 14px;
    }
    .metric-value {
      font-size: 24px;
      font-weight: 600;
      color: #f1f5f9;
    }
    .status {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
    }
    .status-healthy { background: #10b981; color: white; }
    .status-degraded { background: #f59e0b; color: white; }
    .status-unhealthy { background: #ef4444; color: white; }
    .refresh {
      text-align: center;
      margin-top: 20px;
      color: #64748b;
      font-size: 14px;
    }
    .error {
      background: #7f1d1d;
      border: 1px solid #991b1b;
      padding: 16px;
      border-radius: 8px;
      color: #fecaca;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸš€ AI Roadmap Generator - Monitoring Dashboard</h1>
    
    <div id="error" class="error" style="display: none;"></div>
    
    <div class="grid">
      <!-- System Status -->
      <div class="card">
        <h2>System Status</h2>
        <div class="metric">
          <span class="metric-label">Health</span>
          <span id="health-status" class="status status-healthy">Healthy</span>
        </div>
        <div class="metric">
          <span class="metric-label">Uptime</span>
          <span id="uptime" class="metric-value">--</span>
        </div>
        <div class="metric">
          <span class="metric-label">SLA Compliant</span>
          <span id="sla-status" class="status status-healthy">Yes</span>
        </div>
      </div>

      <!-- Performance -->
      <div class="card">
        <h2>Performance</h2>
        <div class="metric">
          <span class="metric-label">Requests/Min</span>
          <span id="rpm" class="metric-value">--</span>
        </div>
        <div class="metric">
          <span class="metric-label">Avg Response</span>
          <span id="avg-response" class="metric-value">--</span>
        </div>
        <div class="metric">
          <span class="metric-label">P95 Response</span>
          <span id="p95-response" class="metric-value">--</span>
        </div>
      </div>

      <!-- Cache -->
      <div class="card">
        <h2>Cache</h2>
        <div class="metric">
          <span class="metric-label">Hit Rate</span>
          <span id="cache-hit-rate" class="metric-value">--</span>
        </div>
        <div class="metric">
          <span class="metric-label">Cache Size</span>
          <span id="cache-size" class="metric-value">--</span>
        </div>
        <div class="metric">
          <span class="metric-label">Utilization</span>
          <span id="cache-util" class="metric-value">--</span>
        </div>
      </div>

      <!-- Resources -->
      <div class="card">
        <h2>Resources</h2>
        <div class="metric">
          <span class="metric-label">CPU Usage</span>
          <span id="cpu-usage" class="metric-value">--</span>
        </div>
        <div class="metric">
          <span class="metric-label">Memory Used</span>
          <span id="memory-used" class="metric-value">--</span>
        </div>
        <div class="metric">
          <span class="metric-label">Heap Used</span>
          <span id="heap-used" class="metric-value">--</span>
        </div>
      </div>

      <!-- Generation Stats -->
      <div class="card">
        <h2>Chart Generation</h2>
        <div class="metric">
          <span class="metric-label">Total</span>
          <span id="gen-total" class="metric-value">--</span>
        </div>
        <div class="metric">
          <span class="metric-label">Success Rate</span>
          <span id="gen-success" class="metric-value">--</span>
        </div>
        <div class="metric">
          <span class="metric-label">Avg Duration</span>
          <span id="gen-duration" class="metric-value">--</span>
        </div>
        <div class="metric">
          <span class="metric-label">Avg Tasks</span>
          <span id="gen-tasks" class="metric-value">--</span>
        </div>
      </div>

      <!-- Errors -->
      <div class="card">
        <h2>Errors</h2>
        <div class="metric">
          <span class="metric-label">Total Errors</span>
          <span id="error-total" class="metric-value">--</span>
        </div>
        <div class="metric">
          <span class="metric-label">Error Rate</span>
          <span id="error-rate" class="metric-value">--</span>
        </div>
        <div id="error-list"></div>
      </div>
    </div>

    <div class="refresh">
      Auto-refreshing every 5 seconds | Last update: <span id="last-update">--</span>
    </div>
  </div>

  <script>
    const API_BASE = window.location.origin;

    function formatUptime(seconds) {
      const hours = Math.floor(seconds / 3600);
      const minutes = Math.floor((seconds % 3600) / 60);
      return `${hours}h ${minutes}m`;
    }

    function formatNumber(num) {
      if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
      if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
      return num.toString();
    }

    async function updateDashboard() {
      try {
        const response = await fetch(`${API_BASE}/api/monitoring/dashboard`);
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}`);
        }

        const data = await response.json();
        const d = data.dashboard;

        // Hide error
        document.getElementById('error').style.display = 'none';

        // System Status
        const healthStatus = d.health.status;
        const healthEl = document.getElementById('health-status');
        healthEl.textContent = healthStatus;
        healthEl.className = `status status-${healthStatus}`;

        document.getElementById('uptime').textContent = formatUptime(d.overview.uptime);

        const slaEl = document.getElementById('sla-status');
        slaEl.textContent = d.sla.compliant ? 'Yes' : 'No';
        slaEl.className = `status status-${d.sla.compliant ? 'healthy' : 'unhealthy'}`;

        // Performance
        document.getElementById('rpm').textContent = d.overview.requestsPerMinute;
        document.getElementById('avg-response').textContent = d.overview.avgResponseTime + 'ms';
        document.getElementById('p95-response').textContent = d.performance.requests.p95Duration + 'ms';

        // Cache
        document.getElementById('cache-hit-rate').textContent = d.performance.cache.hitRate.toFixed(1) + '%';
        document.getElementById('cache-size').textContent = 
          `${d.performance.cache.stats.size.current}/${d.performance.cache.stats.size.max}`;
        document.getElementById('cache-util').textContent = 
          d.performance.cache.stats.utilizationPercent + '%';

        // Resources
        document.getElementById('cpu-usage').textContent = d.system.cpu.usagePercent + '%';
        document.getElementById('memory-used').textContent = d.system.memory.usagePercent + '%';
        document.getElementById('heap-used').textContent = 
          `${d.system.process.memoryUsageMB}MB`;

        // Generation
        document.getElementById('gen-total').textContent = formatNumber(d.performance.generation.total);
        const successRate = d.performance.generation.total > 0 ?
          ((d.performance.generation.successful / d.performance.generation.total) * 100).toFixed(1) :
          100;
        document.getElementById('gen-success').textContent = successRate + '%';
        document.getElementById('gen-duration').textContent = d.performance.generation.avgDuration + 'ms';
        document.getElementById('gen-tasks').textContent = d.performance.generation.avgTasksExtracted.toFixed(1);

        // Errors
        document.getElementById('error-total').textContent = formatNumber(d.errors.total);
        document.getElementById('error-rate').textContent = d.overview.errorRate + '%';

        // Last update
        document.getElementById('last-update').textContent = new Date().toLocaleTimeString();

      } catch (error) {
        console.error('Dashboard update error:', error);
        const errorEl = document.getElementById('error');
        errorEl.textContent = `Failed to fetch dashboard: ${error.message}`;
        errorEl.style.display = 'block';
      }
    }

    // Initial load
    updateDashboard();

    // Auto-refresh every 5 seconds
    setInterval(updateDashboard, 5000);
  </script>
</body>
</html>
